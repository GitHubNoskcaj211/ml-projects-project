FROM golang:1.22 as builder

ARG BACKEND_URL
ARG FRONTEND_URL
ARG STEAM_WEB_API_KEY
ARG GOOGLE_APPLICATION_CREDENTIALS
ARG VERSION
ARG NAME
ARG ROOT_FOLDER
ARG PORT

ENV BACKEND_URL=${BACKEND_URL}
ENV FRONTEND_URL=${FRONTEND_URL}
ENV STEAM_WEB_API_KEY=${STEAM_WEB_API_KEY}
ENV GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS}
ENV VERSION=${VERSION}
ENV NAME=${NAME}
ENV ROOT_FOLDER=${ROOT_FOLDER}
ENV PORT=${PORT}

WORKDIR /app

COPY dataset/data_files/games.json ./dataset/data_files/

COPY go_backend/. .

RUN go mod download

RUN go build -a -installsuffix cgo -o backend .

ENTRYPOINT /app/backend
